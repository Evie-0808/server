[supervisord]
nodaemon=true  # 前台运行，确保容器不退出

[unix_http_server]
file=/var/run/supervisor.sock  # 这里的路径
chmod=0700

[supervisorctl]
# 与 supervisord 主进程通信的方式（推荐用 unix socket，比 TCP 更安全）
# 路径需与 [unix_http_server] 段的 file 一致（若没有 [unix_http_server]，需新增）
serverurl=unix:///var/run/supervisor.sock  # 核心配置：指定通信 socket 路径

# 启动 FastAPI 后端
[program:backend]
command=uvicorn backend.main:app --host 0.0.0.0 --port 8001 --reload  # --reload 支持后端热更新
directory=/app
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# 启动 Vue 开发服务器（支持热重载）
[program:frontend]
command=npm run serve  # 启动 Vue 开发服务器（而非构建静态文件）
directory=/app/frontend
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0